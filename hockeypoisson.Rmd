---
title: "Hockey Poisson"
author: "Ian Thorpe"
date: "4/4/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
```


```{r}
hockey_data <- read.delim('hockeystats.txt', sep = ",")
hockey_data %>%
  rename(away_goals = G) %>%
  rename(home_goals = G.1) %>%
  select(-c(X, Att., LOG, Notes)) %>%
  na.omit() -> hockey_data

write.csv(hockey_data, "hockeydata.csv")
  
```

```{r}
pois_prob = function(home_team, away_team) {
  hockey_data %>%
    filter(Visitor == away_team) %>%
    summarise(avg_gf_visit = sum(away_goals)/n(),
              avg_ga_visit = sum(home_goals)/n()) -> away_data
  
  hockey_data %>%
    filter(Home == home_team) %>%
    summarise(avg_gf_home = sum(home_goals)/n(),
              avg_ga_home = sum(away_goals)/n()) -> home_data
  
  
  
  avg_gf_home_league <- mean(hockey_data$home_goals)
  avg_gf_away_league <- mean(hockey_data$away_goals)
  
  home_attack <- home_data$avg_gf_home/avg_gf_home_league
  away_attack <- away_data$avg_gf_visit/avg_gf_away_league
  
  home_defense <- home_data$avg_ga_home/avg_gf_away_league
  away_defense <- away_data$avg_ga_visit/avg_gf_home_league
  
  home_exp_gf <- round(home_attack * away_defense * avg_gf_home_league, 2)
  away_exp_gf <- round(away_attack * home_defense * avg_gf_away_league, 2)
  
  cat(home_team, "expG", ": ", home_exp_gf, " ", away_team, "expG", ": ", away_exp_gf, "\n")
  
  cat("Total expG: ", round(home_exp_gf+away_exp_gf, 1), '\n')
  
  home_in_reg <- mean(rpois(10000, home_exp_gf) > rpois(10000, away_exp_gf))
  away_in_reg <- mean(rpois(10000, away_exp_gf) > rpois(10000, home_exp_gf))
  tie_in_reg <- 1-home_in_reg-away_in_reg
  
  cat(home_team, 'will win in regulation', round(home_in_reg*100, 2), '% of the time', '\n')
  cat(away_team, 'will win in regulation', round(away_in_reg*100, 2), '% of the time', '\n')
  cat('Regulation will end in a tie', round(tie_in_reg*100, 2), '% of the time')
  
}


```


